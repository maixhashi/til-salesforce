# Salesforce Visualforce

## What's this file?
> [!NOTE]
> **What**
> 
> Salesforce Visualforceとは何かについて記載しています。

## Conclusion (忙しいとき向け)
> [!IMPORTANT]
> **What** : Salesforce Visualforceとは何か
> 
> **Answer** : SalesforceプラットフォームでカスタムUIを構築するためのWebフレームワークで、MVCアーキテクチャに基づいたタグベースのマークアップ言語

## 目次

<details>
<summary>目次を開く</summary>

- [1. Visualforceの概要](#1-visualforceの概要)
- [2. アーキテクチャと構成要素](#2-アーキテクチャと構成要素)
- [3. 主要な機能と特徴](#3-主要な機能と特徴)
- [4. 利用シーンと制限事項](#4-利用シーンと制限事項)
- [5. Lightning Web Componentsとの比較](#5-lightning-web-componentsとの比較)

</details>

## 1. Visualforceの概要

### 1.1 基本的な定義

Visualforceは、Salesforceプラットフォーム上でカスタムユーザーインターフェースを構築するためのWebアプリケーションフレームワークです。

```mermaid
flowchart TD
    A[Visualforce] --> B[ページ定義]
    A --> C[コントローラー]
    A --> D[データバインディング]
    
    B --> E[HTMLライクなマークアップ]
    B --> F[Visualforceタグ]
    B --> G[標準コンポーネント]
    
    C --> H[Apexコントローラー]
    C --> I[標準コントローラー]
    C --> J[拡張コントローラー]
    
    D --> K[自動データ同期]
    D --> L[リアルタイム更新]
```

### 1.2 歴史的背景

- **2008年**: Visualforceリリース
- **2014年**: Lightning Experience発表
- **2019年**: Lightning Web Components推奨
- **現在**: レガシーシステムとして保守継続

## 2. アーキテクチャと構成要素

### 2.1 MVCアーキテクチャ

```mermaid
flowchart LR
    subgraph Model
        A[Salesforceオブジェクト]
        B[カスタムオブジェクト]
        C[Apexクラス]
    end
    
    subgraph View
        D[Visualforceページ]
        E[コンポーネント]
        F[静的リソース]
    end
    
    subgraph Controller
        G[標準コントローラー]
        H[カスタムコントローラー]
        I[拡張コントローラー]
    end
    
    Model <--> Controller
    Controller <--> View
    View --> J[ユーザー]
    J --> Controller
```

### 2.2 基本的な構文

**Visualforceページの例：**
```xml
<apex:page controller="MyCustomController">
    <apex:form>
        <apex:pageBlock title="アカウント情報">
            <apex:pageBlockSection>
                <apex:inputField value="{!account.Name}"/>
                <apex:inputField value="{!account.Phone}"/>
            </apex:pageBlockSection>
            <apex:pageBlockButtons>
                <apex:commandButton action="{!save}" value="保存"/>
            </apex:pageBlockButtons>
        </apex:pageBlock>
    </apex:form>
</apex:page>
```

### 2.3 コンポーネント階層

```mermaid
flowchart TD
    A[apex:page] --> B[apex:form]
    B --> C[apex:pageBlock]
    C --> D[apex:pageBlockSection]
    C --> E[apex:pageBlockButtons]
    D --> F[apex:inputField]
    D --> G[apex:outputField]
    E --> H[apex:commandButton]
    E --> I[apex:commandLink]
```

## 3. 主要な機能と特徴

### 3.1 標準機能

| 機能 | 説明 |
|------|------|
| データバインディング | {!expression}構文による自動同期 |
| 標準コントローラー | CRUDオペレーションの自動実装 |
| ビューステート | フォーム状態の自動管理 |
| AJAX対応 | 部分的なページ更新 |
| PDFレンダリング | renderAs="pdf"による出力 |

### 3.2 セキュリティ機能

```mermaid
flowchart LR
    A[セキュリティ機能] --> B[CSRF保護]
    A --> C[XSS防止]
    A --> D[FLSチェック]
    A --> E[共有ルール適用]
    
    B --> F[自動トークン生成]
    C --> G[自動エスケープ]
    D --> H[フィールドレベルセキュリティ]
    E --> I[レコードアクセス制御]
```

### 3.3 組み込みコンポーネント

**主要なコンポーネント：**
- **apex:pageBlock**: 標準的なSalesforceレイアウト
- **apex:dataTable**: データテーブル表示
- **apex:chart**: グラフ表示
- **apex:map**: 地図表示
- **apex:relatedList**: 関連リスト

## 4. 利用シーンと制限事項

### 4.1 適切な利用シーン

```mermaid
flowchart TD
    A[Visualforce推奨シーン] --> B[PDF生成]
    A --> C[メール テンプレート]
    A --> D[複雑なレイアウト]
    A --> E[Classic専用機能]
    
    B --> B1[請求書]
    B --> B2[レポート]
    
    C --> C1[HTMLメール]
    C --> C2[動的コンテンツ]
    
    D --> D1[ウィザード形式]
    D --> D2[マルチステップフォーム]
    
    E --> E1[インラインVF]
    E --> E2[ホームページコンポーネント]
```

### 4.2 制限事項

| 制限項目 | 制限値 |
|----------|--------|
| ビューステートサイズ | 170KB |
| ページサイズ | 15MB |
| コレクションサイズ | 1,000レコード |
| SOQL クエリ数 | 100 |
| DML ステートメント数 | 150 |

### 4.3 パフォーマンス考慮事項

```mermaid
flowchart LR
    A[パフォーマンス要因] --> B[ビューステート]
    A --> C[SOQL最適化]
    A --> D[レンダリング]
    
    B --> E[最小化戦略]
    C --> F[遅延読み込み]
    D --> G[部分更新]
    
    E --> H[Transient変数]
    F --> I[ページネーション]
    G --> J[reRender属性]
```

## 5. Lightning Web Componentsとの比較

### 5.1 技術スタック比較

```mermaid
flowchart TD
    subgraph Visualforce
        A[サーバーサイドレンダリング]
        B[独自タグ言語]
        C[Apexコントローラー必須]
        D[Classic UI対応]
    end
    
    subgraph "Lightning Web Components"
        E[クライアントサイドレンダリング]
        F[Web標準準拠]
        G[JavaScript中心]
        H[Lightning Experience最適化]
    end
    
    A -.->|移行| E
    B -.->|移行| F
    C -.->|移行| G
    D -.->|移行| H
```

### 5.2 機能比較表

| 項目 | Visualforce | Lightning Web Components |
|------|-------------|-------------------------|
| レンダリング | サーバーサイド | クライアントサイド |
| 開発言語 | Apex + VFタグ | JavaScript + HTML |
| パフォーマンス | 中程度 | 高速 |
| モバイル対応 | 限定的 | フル対応 |
| 開発効率 | 中程度 | 高い |
| 学習曲線 | 緩やか | やや急 |

### 5.3 移行戦略

```mermaid
flowchart LR
    A[既存VFページ] --> B{評価}
    B -->|シンプル| C[LWCへ直接移行]
    B -->|複雑| D[段階的移行]
    B -->|PDF/Email| E[VF継続利用]
    
    D --> F[ハイブリッド実装]
    F --> G[部分的LWC化]
    G --> H[完全LWC化]
```

## 関連

- [Visualforce開発者ガイド](https://developer.salesforce.com/docs/atlas.en-us.pages.meta/pages/)
- [Visualforceタグリファレンス](https://developer.salesforce.com/docs/atlas.en-us.pages.meta/pages/pages_compref.htm)
- [Lightning Web Components移行ガイド](https://developer.salesforce.com/docs/component-library/tools/lwc-dev)
- [Apexコントローラーベストプラクティス](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_controller_vf.htm)
- [Visualforceパフォーマンスベストプラクティス](https://developer.salesforce.com/docs/atlas.en-us.salesforce_visualforce_best_practices.meta/salesforce_visualforce_best_practices/)