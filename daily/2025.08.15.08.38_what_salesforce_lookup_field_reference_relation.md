# Salesforceの参照関係におけるルックアップ項目

## What's this file?
> [!NOTE]
> **What**
> 
> Salesforceの参照関係におけるルックアップ項目とは何かについて記載しています。

## Conclusion (忙しいとき向け)
> [!IMPORTANT]
> **What** : Salesforceの参照関係におけるルックアップ項目とは何か
> 
> **Answer** : ルックアップ項目は、Salesforceで2つのオブジェクト間に任意の参照関係を作成する項目タイプで、削除時の動作が柔軟で、親レコードが削除されても子レコードは残る特徴を持つ。

## 目次

<details>
<summary>目次を開く</summary>

- [ルックアップ項目の基本概念](#ルックアップ項目の基本概念)
- [ルックアップ項目の特徴](#ルックアップ項目の特徴)
- [主従関係との違い](#主従関係との違い)
- [ルックアップ項目の使用例](#ルックアップ項目の使用例)
- [ルックアップ項目の設定方法](#ルックアップ項目の設定方法)

</details>

## ルックアップ項目の基本概念

ルックアップ項目は、Salesforceにおける**リレーション（関係）項目**の一種です。あるオブジェクトから別のオブジェクトのレコードを参照するための項目タイプで、データベースにおける外部キーに相当します。

```mermaid
flowchart LR
    A[取引先責任者<br/>（子オブジェクト）] -->|ルックアップ項目| B[取引先<br/>（親オブジェクト）]
    C[商談] -->|ルックアップ項目| B
    D[ケース] -->|ルックアップ項目| A
    
    style A fill:#e1f5ff
    style B fill:#ffe1e1
    style C fill:#e1f5ff
    style D fill:#e1f5ff
```

## ルックアップ項目の特徴

### 1. 任意の関係性
- 子レコードに親レコードを設定することは**任意**（必須ではない）
- 空白値を許可できる

### 2. 削除時の動作
```mermaid
flowchart TD
    A[親レコードを削除] --> B{ルックアップ項目の<br/>削除設定}
    B -->|関係をクリア| C[子レコードのルックアップ項目を<br/>空白にする]
    B -->|この項目を削除できないように制限| D[子レコードが存在する場合<br/>親レコードを削除不可]
    
    style A fill:#ffe1e1
    style B fill:#fff5e1
    style C fill:#e1ffe1
    style D fill:#e1e1ff
```

### 3. 柔軟性
- 1つのオブジェクトに最大40個のルックアップ項目を作成可能
- 自己参照（同じオブジェクトへの参照）も可能

## 主従関係との違い

| 特徴 | ルックアップ関係 | 主従関係 |
|------|-----------------|----------|
| 親レコードの必須性 | 任意 | 必須 |
| 親レコード削除時 | 子レコードは残る | 子レコードも削除 |
| 最大作成数 | 40個 | 2個 |
| 所有者の継承 | なし | あり |
| 積み上げ集計項目 | 使用不可 | 使用可能 |

## ルックアップ項目の使用例

### 実際のビジネスシナリオ

```mermaid
flowchart TD
    subgraph "営業管理の例"
        A[商談] -->|取引先責任者<br/>ルックアップ| B[取引先責任者]
        A -->|取引先<br/>ルックアップ| C[取引先]
        D[活動] -->|関連先<br/>ルックアップ| A
        D -->|関連先<br/>ルックアップ| B
    end
    
    style A fill:#e1f5ff
    style B fill:#ffe1e1
    style C fill:#ffe1e1
    style D fill:#e1f5ff
```

### 一般的な使用ケース
1. **取引先と取引先責任者**: 取引先責任者が複数の取引先に関連付けられる場合
2. **商談と取引先**: 商談は取引先を参照するが、取引先が削除されても商談記録は保持
3. **ケースと取引先責任者**: サポートケースが特定の取引先責任者に関連

## ルックアップ項目の設定方法

### 作成手順

```mermaid
flowchart TD
    A[設定] --> B[オブジェクトマネージャ]
    B --> C[対象オブジェクトを選択]
    C --> D[項目とリレーション]
    D --> E[新規作成]
    E --> F[ルックアップ関係を選択]
    F --> G[参照先オブジェクトを選択]
    G --> H[項目の詳細設定]
    H --> I[項目レベルセキュリティ設定]
    I --> J[ページレイアウトへの追加]
    
    style A fill:#e1f5ff
    style E fill:#ffe1e1
    style F fill:#ffe1e1
    style J fill:#e1ffe1
```

### 設定時の考慮事項

1. **ルックアップフィルタ**: 選択可能なレコードを制限
2. **削除時の動作**: 「関係をクリア」または「削除を制限」を選択
3. **必須設定**: ビジネス要件に応じて必須/任意を決定

## 関連

- [Salesforceのリレーション（関係）の種類](https://help.salesforce.com/s/articleView?id=sf.relationships_overview.htm)
- [主従関係との使い分け](https://developer.salesforce.com/docs/atlas.ja-jp.object_reference.meta/object_reference/relationships_among_objects.htm)
- [ルックアップフィルタの設定方法](https://help.salesforce.com/s/articleView?id=sf.fields_lookup_filters.htm)